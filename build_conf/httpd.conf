# vim: set syntax=apache
#
# ###########################################################
# nuinfo apache httpd.conf file
# ###########################################################

# Set Global Non-System Specific Flags
include /etc/httpd/conf.d/apache-options.conf

# Set Global System Specific Flags
include /etc/httpd/localhost_configs/local_httpd.conf

# Apache Environment variables:
#
# NODENUMBER is a two-digit number as above
# NODENAME is the unqualified hostname, like: evnuinfoprodweb1
# NODEFQDN is the full DNS name like: evnuinfoprodweb1.it.${local_Domain_Name}
# ${local_Domain_Name} variable is used to switch from production to development domain names
# ----------------------------------------------
#

# ----------------------------------------------
# Related Apache configuration files included below are:
#
# main-only.conf    directives that apply only to the main host
#                   or near clones of it
#
# main-head.conf    configuration that only applies to the
#                   main host and not its clones (plus
#                   some things that needed to be up front)
#
# virtual.conf      virtual host configuration
#
# virtual-redirect.conf redirects of virtual host document roots under htdocs
#                       included into the main host configuration
#
# mime.types            the usual Apache MIME type mapping file
#
# Other configuration files:
#
# policy-url-file.txt   List of URLs for which Access Manager should be turned on
#                       (Used to build the inverted "not enforced list" via
#                       a java program.)
#
#
# ----------------------------------------------
#
include /opt/websso/web_agents/apache24_agent/Agent_001/config/dsame.conf

# listen on my inteface port 80

${local_IPv4_Address}

# IPv4 localhost:
Listen 127.0.0.1:80

# IPv6 localhost/loopback address is ::1
Listen [::1]:80

# Add Apache Optional Modules
include /etc/httpd/conf.d/apache-load-modules.conf

#---------------------------------------
# This section needs to go after the LoadModule directives on Linux
#---------------------------------------
# SSI booleans
# note: SSIs treat non-null as true, so use "" as false, "1" as true
#

SetEnv ON_MIRROR    ""
# for backwards compatability:
SetEnv ON_MAINHOST  "1"
SetEnv ON_CLUSTER   "1"

#---------------------------------------

SetEnv NODENUMBER ${local_Node_Number}
SetEnv NODENAME ${local_Host_Name}
SetEnv NODEFQDN ${local_FQDN_Name}

User  webserv
Group webserv

# ServerAdmin: Your address, where problems with the server should be
# e-mailed.

ServerAdmin webmaster@${local_Domain_Name}

LogLevel ${local_LogLevel}

# Turn on DNS lookups for our stats again for 1.3, default is now off
HostNameLookups on

# ExtendedStatus Added in 1.3.2
ExtendedStatus on

# Logs to Directories Under /nuinfo/current-logs/httpd

# ErrorLog: The location of the error log file. If this does not start
# with /, ServerRoot is prepended to it.

# give nuinfo log format a nickname to help define custom logs 12-16-06
LogFormat "%V %h %l %u %t \"%r\" %s %b \"%{Referer}i\" \"%{User-agent}i\"" vhost_plus_combined

LogFormat vhost_plus_combined

LogFormat "%a %h %>s %B %m %H %T %v %p %t \"%r\"" ip_tracking

LogFormat "%h %l %u %t \"%r\" %>s %B \"%{Referer}i\" \"%{User-agent}i\" %V %a" combined_plus_vhost_ip

# new log format for cluster replaces access_log+traffic_log with an expanded access log:
#
# timestamp node number "combined log" virtual-host canonical-virtual-host IP-address input-bytes output-bytes
LogFormat "%{%Y-%m-%d %H:%M:%S}t %{NODENUMBER}e %h %l %u %t \"%r\" %s %b \"%{Referer}i\" \"%{X-Forwarded-For}i\" \"%{User-agent}i\" %V %v %a  %I %O" extended1

# new log format for cluster replaces access_log+traffic_log with expanded access log

# error_log, access_log piped to rotatelogs, with per-host filenames

# There seems to be no way to substitute something in the filename
# so we need an IfDefine on the node name symbol (ack!)

# LogFormat "%v %{X-Forwarded-For}i %a %{c}a %l %u %t \"%r\" %>s %b" X-Forwarded-For
# CustomLog /var/log/httpd/x-forwarded-for.log X-Forwarded-For

<IfDefine HEVNUINFOPRODWEB1>
    # server evnuinfoprodweb1.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_evnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_evnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_evnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server evnuinfoprodweb1
</IfDefine>

<IfDefine HEVNUINFOPRODWEB2>
    # server evnuinfoprodweb2.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_evnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_evnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_evnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server evnuinfoprodweb2
</IfDefine>

<IfDefine HEVNUINFOPRODWEB3>
    # server evnuinfoprodweb3.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_evnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_evnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_evnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server evnuinfoprodweb3
</IfDefine>

<IfDefine HEVNUINFOPRODWEB4>
    # server evnuinfoprodweb4.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_evnuinfoprodweb4.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_evnuinfoprodweb4.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_evnuinfoprodweb4.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server evnuinfoprodweb4
</IfDefine>

<IfDefine HCHNUINFOPRODWEB1>
    # server chnuinfoprodweb1.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_chnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_chnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_chnuinfoprodweb1.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server chnuinfoprodweb1
</IfDefine>

<IfDefine HCHNUINFOPRODWEB2>
    # server chnuinfoprodweb2.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_chnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_chnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_chnuinfoprodweb2.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server chnuinfoprodweb2
</IfDefine>

<IfDefine HCHNUINFOPRODWEB3>
    # server chnuinfoprodweb3.it.${local_Domain_Name}

        # port 80 production server instance
        # error log
        ErrorLog "|/sbin/rotatelogs -f  /var/log/httpd/error_log_chnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400"

        # primary access log
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_chnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=!donotlogthis

        # log of skipped requests
        CustomLog "|/sbin/rotatelogs -f  /var/log/httpd/access_log_skipped_chnuinfoprodweb3.%Y-%m-%d-%H_%M_%S.txt 86400" extended1 env=donotlogthis

        # end if port 80

    # end if server chnuinfoprodweb3
</IfDefine>

# PidFile: The file the server should log its pid to

# Most things interact with the /etc/init.d/FOO scripts
# but some Linux scripts/commands may look for pid files in /var/run
# so follow that convention
# Red Hat defines a server root of /etc/httpd and
# makes a symlink /etc/httpd/run -> ../../var/run
# So the pid file is really /var/run/httpd.pid
PidFile /var/run/httpd.pid

# Red Hat httpd is built with the default ScoreBoardFile
# path "logs/apache_runtime_status" and the default server root "/etc/httpd".
#

ScoreBoardFile /var/log/httpd/apache_runtime_status

# ServerName allows you to set a host name which is sent back to clients for
# your server if it's different than the one the program would get (i.e. use
#"www" instead of the host's real name).

ServerName www.northwestern.edu

# to help host name logging 3/8/00
UseCanonicalName off

<IfDefine RANGEFIX>
    # drop Range and Request-Range headers with too many byte ranges
    # to work-around DOS attack CVE-2011-3192
    # http://article.gmane.org/gmane.comp.apache.announce/58
    # http://www.kb.cert.org/vuls/id/405811

    # second fix from http://www.kb.cert.org/vuls/id/405811
    #----------
    # Reject request when more than 5 ranges in the Range: header.
    #
    RewriteEngine on
    RewriteCond %{HTTP:range} !(bytes=[^,]+(,[^,]+){0,4}$|^$)
    RewriteRule .* - [F]

    # We always drop Request-Range; as this is a legacy
    # dating back to MSIE3 and Netscape 2 and 3.
    RequestHeader unset Request-Range
    #----------

</IfDefine>

#- - - - -
# Do we still need this - DPB
# Browser hacks on keepalive, etc.
# local CGI bug
BrowserMatch "Mozilla/3\.[0-9]+ \(Win" nokeepalive
# recommended by Apache docs
BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.02b;" nokeepalive
BrowserMatch "MSIE 4\.02b;" downgrade-1.0 force-response-1.0
BrowserMatch "Java1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0
BrowserMatch "RealPlayer 4\.0" force-response-1.0

# KeepAlive: The number of Keep-Alive persistent requests to accept
# per connection. Set to 0 to deactivate Keep-Alive support

KeepAlive on
#- - - - -

# KeepAliveTimeout: Number of seconds to wait for the next request
# decrease to 10 12-9-08

KeepAliveTimeout 10

#
# GracefulShutDownTimeout: Specify a timeout after which
# a gracefully shutdown server will exit. (new in Apache 2.2)
#
# "The GracefulShutdownTimeout specifies how many seconds after
# receiving a "graceful-stop" signal, a server should continue to run,
# handling the existing connections."
#
# "Setting this value to zero means that the server will wait
# indefinitely until all remaining requests have been fully served."

# It appears that setting this too long can interfere with
# server restarts done using a HUP.
#
# This isn't documented, but 60 seconds seems to be too long

GracefulShutDownTimeout 20

# Under the lightest of loads the minimum number of servers to have
<IfModule mpm_prefork_module>
MinSpareServers 40
</IfModule>
<IfModule mpm_worker_module>
MinSpareThreads 40
</IfModule>

# Under the heaviest of loads the maximum number of servers to spawn
<IfModule mpm_prefork_module>
MaxSpareServers 100
</IfModule>
<IfModule mpm_worker_module>
ThreadsPerChild 25
</IfModule>

# Timeout: The number of seconds before receives and sends time out
# Timeout 300
# Adjustment for security based on the Qualys acanner
TimeOut 60

# 03-09-2017 Qualys security tweaks
ServerTokens Prod
ServerSignature Off
LimitRequestBody 102400

# Changed values based on using threads and not processes as in the past with prefork
<IfModule mpm_prefork_module>
# On start create this number of servers
StartServers 40

ServerLimit 2600
MaxClients 2600

MaxRequestsPerChild 1000
</IfModule>

# Values for the threaded model of httpd
<IfModule mpm_worker_module>
StartServers 10

ServerLimit 250
MaxConnectionsPerChild 0
MaxRequestWorkers 6000
MaxSpareThreads 6000
</IfModule>

# 
# Compensate for F5 showing as the source IP
# Use X-Forwarded-For as the source IP
RemoteIPHeader X-Forwarded-For
RemoteIPTrustedProxy 129.105.136.0/8 165.124.135.0/8
#

TypesConfig /etc/httpd/conf.d/mime.types

# Make sure json files are interpreted as UTF-8
AddCharset UTF-8 .json

# server-wide environment variable for NU domain test
# this will have a value of "1" or be unset, it's not a zero/one variable
#
# To test in SSIs use: <!--#if expr="$FROM_NU_DOMAIN = '1'" -->
#
SetEnvIfNoCase Remote_Host "northwestern\.edu$" FROM_NU_DOMAIN 1

# server-wide environment variable to help us special-case the prototype host 1-2-02
SetEnv  PRODUCTION_SERVER   "1"

#---------------------------------------
# memory cache experiments 1-20-09

<IfDefine MCACHE>
    <IfModule mod_cache.c>
    <IfModule mod_mem_cache.c>

        # 30 min max expire
        CacheMaxExpire 1800

        # 256 Mbyte cache
        MCacheSize 262144

        MCacheMaxObjectCount 500

        MCacheMinObjectSize 10

        # 2 Mbyte Max object size
        MCacheMaxObjectSize 2097152

        MCacheRemovalAlgorithm GDSF


    </IfModule>
    </IfModule>
</IfDefine>

# mod_deflate experiments 5-13-09
<IfDefine DEFLATE>
    <IfModule mod_deflate.c>

        # the size in bytes of the fragments that zlib should compress at one time.
        DeflateBufferSize 8096

        # What level of compression should be used
        # The higher the value, the better the compression
        # The value must between 1 (less compression) and 9 (more compression).
        DeflateCompressionLevel 6

        # How much memory should be used by zlib for compression
        # (a value between 1 and 9).
        DeflateMemLevel 8

        # The zlib compression window size (a value between 1 and 15)
        # Generally, the higher the window size, the higher can
        # the compression ratio be expected.
        # The value must between 1 (less compression) and 9 (more compression).
        DeflateCompressionLevel 6

        # How much memory should be used by zlib for compression
        # (a value between 1 and 9).
        DeflateMemLevel 8

        # The zlib compression window size (a value between 1 and 15)
        # Generally, the higher the window size, the higher can
        # the compression ratio be expected.
        DeflateWindowSize 15

        # Netscape 4.x has some problems...
        BrowserMatch ^Mozilla/4 gzip-only-text/html

        # Netscape 4.06-4.08 have some more problems
        BrowserMatch ^Mozilla/4\.0[678] no-gzip

        # MSIE masquerades as Netscape, but it is fine
        # BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

        # Use AddOutputFilterByType to turn on selectively in containers, like:
        # "AddOutputFilterByType INCLUDES;DEFLATE text/html"

        # Append Vary: header where we actually turn on the filter, using:
        # "Header append Vary User-Agent"

       SetOutputFilter DEFLATE
       AddOutputFilterByType DEFLATE text/html

       # Do not compress the following patterns - Darryl Baker (dpb657) 11/04/2015
       SetEnvIfNoCase Request_URI \.(?:mp3|mp4|wma|mov)$  no-gzip dont-vary 
       SetEnvIfNoCase Request_URI \.(?:woff|woff2)$  no-gzip dont-vary 
       SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$  no-gzip dont-vary 
       SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
       SetEnvIfNoCase Request_URI \.pdf$ no-gzip dont-vary


    </IfModule>
</IfDefine>


#---------------------------------------


<VirtualHost _default_>
    # We use a _different_ server name than the main host
    # to keep it from stealing requests from the main host despite being the
    # first explicit VirtualHost

    # NOTE: REMOVING THIS ServerName DIRECTIVE WILL BREAK www.${local_Domain_Name}

    ServerName fallback.${local_Domain_Name}

    DocumentRoot /nuinfo/httpd/more-docs/name-virtual-host-doc-root
    SetEnvIf Request_URI "/health-check-test.txt" donotlogthis

    # disable the normal CGI directory on this error site
    ScriptAlias /cgi-bin/   /nuinfo/httpd/more-docs/empty-placeholder/

    # nearly all requests get the same message
    ErrorDocument 404 /index.html

</VirtualHost>


# ###########################################################
# aliases and redirects that we don't want inherited by other virtual hosts
# except hosts set up specifically to imitate the main host
# ###########################################################

# MAIN host VirtualHost

<VirtualHost *>
    ServerName www.northwestern.edu
    ServerAlias www.${local_Domain_Name}

    # Add "northwestern.edu" for future move of the A record
    # This will redirect to www.northwestern.edu
    ServerAlias ${local_Domain_Name}
    # Added for testing only
    ServerAlias northwestern.edu
    <IfDefine HEVNUINFOPRODWEB1>
    ServerAlias nuinfo.northwestern.edu
    </IfDefine>

    <IfDefine EXPOSENODES>
        # expose the cluster nodes as names for the main host and do not redirect
        # We DO NOT want to do this in production
        # Access manager rules were not designed with this in mind
        ServerAlias evnuinfoprodweb1.ci.${local_Domain_Name}
        ServerAlias evnuinfoprodweb2.ci.${local_Domain_Name}
        ServerAlias evnuinfoprodweb3.ci.${local_Domain_Name}
        ServerAlias evnuinfoprodweb4.ci.${local_Domain_Name}
        ServerAlias chnuinfoprodweb1.ci.${local_Domain_Name}
        ServerAlias chnuinfoprodweb2.ci.${local_Domain_Name}
        ServerAlias chnuinfoprodweb3.ci.${local_Domain_Name}
        ServerAlias nuinfo.wideip.${local_Domain_Name}
        # ServerAlias common.wideip.${local_Domain_Name}
    </IfDefine>

    RewriteCond %{HTTP_HOST}      !^$
    RewriteCond %{REQUEST_METHOD} !=POST
    RewriteCond %{HTTP_HOST}      !=www.${local_Domain_Name}           [NC]
    RewriteRule ^/(.*)$           http://www.${local_Domain_Name}/$1   [R=permanent,L,NS]

    # 02-02-2017 For the Qualys scanner
    Header always append X-Frame-Options SAMEORIGIN

    # 11-2-01
    # main-head.conf is stuff that only applies to the main host,
    # and _not_ virtual hosts that clone it
    # (it used to me at the start of main-only.conf)

    <IfDefine TEST_DIR>
        include /etc/httpd/build_conf/main-head.conf
    </IfDefine>
    <IfDefine !TEST_DIR>
        include /etc/httpd/conf.d/main-head.conf
    </IfDefine>

    # 11-2-01
    # main-only.conf is directives that can be shared
    # by virtual host clones of the main host

    <IfDefine TEST_DIR>
        include /etc/httpd/build_conf/main-only.conf
    </IfDefine>
    <IfDefine !TEST_DIR>
        include /etc/httpd/conf.d/main-only.conf
    </IfDefine>

    <IfDefine TEST_DIR>
        include /etc/httpd/build_conf/virtual-redirect.conf
    </IfDefine>
    <IfDefine !TEST_DIR>
        include /etc/httpd/conf/virtual-redirect.conf
    </IfDefine>

</VirtualHost>

# virtual hosts config includes

<IfDefine TEST_DIR>
    include /etc/httpd/build_conf/virtual.conf
</IfDefine>
<IfDefine !TEST_DIR>
    include /etc/httpd/conf/virtual.conf
</IfDefine>

# end virtual hosts config
#

# ###########################################################
# start of former srm.conf
# ###########################################################

# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.

DocumentRoot /nuinfo/httpd/htdocs

# UserDir: The name of the directory which is appended onto a user's home
# directory if a ~user request is recieved.

# UserDir public_html
# NUInfo/www.${local_Domain_Name} doesn't support personal web pages.
UserDir disabled

# DirectoryIndex: Name of the file to use as a pre-written HTML
# directory index

DirectoryIndex index.html index.htm Default.html welcome.html index.ssi index.shtml index.asp index.xml

# fancy indexing minus ignore/readme features added 7/1/97

IndexOptions FancyIndexing IconsAreLinks

# Default Expiration Times - added 11/26/97 because of interaction
# with SSI last mod times
# This will allow some caching of SSI pages

ExpiresActive On
# 24 hours after access time for unknown types
ExpiresDefault A86400

# Images expire in a week
ExpiresByType image/gif A604800
ExpiresByType image/jpeg A604800
ExpiresByType image/png A604800

<IfDefine !EXPOSENODES>
    # Expire text in 6 hours
    ExpiresByType text/html A21600
</IfDefine>
<IfDefine EXPOSENODES>
    # testing only, the EXPOSENODES option should not be used in production
    # Expire text in 5 minutes
    ExpiresByType text/html A300
</IfDefine>

<Directory /nuinfo/httpd/htdocs/virtualstore/ >
    # special case for /virtualstore/ added 7/17/98

    # Expire text in 2 hours
    ExpiresByType text/html A7200

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/htdocs/top-menu/ >
    # special case for older top menu directory 8-3-06

    # Expire text in 1 hour
    ExpiresByType text/html A3600

    SSILegacyExprParser on
</Directory>

# <Location> blocks for main host moved to main-only.conf 3-27-07
# to avoid side effects on virtual hosts

# note: Hereandnow has a server-wide expire time setting

# AddIcon tells the server which icon to show for different files or filename
# extensions

AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip

AddIconByType (TXT,/icons/text.gif) text/*
AddIconByType (IMG,/icons/image2.gif) image/*
AddIconByType (SND,/icons/sound2.gif) audio/*
AddIconByType (VID,/icons/movie.gif) video/*

AddIcon /icons/binary.gif .bin .exe
AddIcon /icons/binhex.gif .hqx
AddIcon /icons/tar.gif .tar
AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
AddIcon /icons/a.gif .ps .ai .eps
# AddIcon /icons/layout.gif .html .shtml .htm .pdf
# add new server-side include types 10-16-97
AddIcon /icons/layout.gif .html .shtml .htm .pdf .ssi .asp
AddIcon /icons/text.gif .txt
AddIcon /icons/c.gif .c
AddIcon /icons/p.gif .pl .py
AddIcon /icons/f.gif .for
AddIcon /icons/dvi.gif .dvi
AddIcon /icons/uuencoded.gif .uu
AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
AddIcon /icons/tex.gif .tex
AddIcon /icons/bomb.gif core
AddIcon /icons/back.gif ..
AddIcon /icons/hand.right.gif README
AddIcon /icons/folder.gif ^^DIRECTORY^^
AddIcon /icons/blank.gif ^^BLANKICON^^

# DefaultIcon is which icon to show for files which do not have an icon
# explicitly set.

DefaultIcon /icons/unknown.gif

# end of fancy indexing

# AccessFileName: The name of the file to look for in each directory
# for access control information.

AccessFileName .htaccess

# DefaultType is the default MIME type for documents which the server
# cannot find the type of from filename extensions.

# DefaultType text/plain

# AddType allows you to tweak mime.types without actually editing it, or to
# make certain files to be certain types.
# Format: AddType type/subtype ext1

AddType text/html crd

# Stuff for viewing tidle files 10/7/97
AddType text/html html~
AddType text/html htm~
AddType text/html HTML~
AddType text/html HTM~

# explict extensions for server-side includes 10/16/97
AddType text/html .shtml
AddHandler server-parsed .shtml

# Added for cross-platform compatiblity with Webstar
AddType text/html .ssi
AddHandler server-parsed .ssi

# Added for cross-platform compatiblity with MS IIS
AddType text/html .asp
AddHandler server-parsed .asp

# SSIs everywhere - test 7/14/00 (not put in production) - retest 7/25/00
AddType text/html .html
AddHandler server-parsed .html
#
AddType text/html .htm
AddHandler server-parsed .htm

# Requested by Adam Skrzypulec on 10/11/13
AddType image/svg+xml svg

# 10/29/98 special exception for www.univsvcs.${local_Domain_Name} and www.gensvcs.${local_Domain_Name}
# change the default mime type for /university-services/ stuff moved from
# mac that does not end in .html
<Directory /nuinfo/httpd/htdocs/university-services >
#    DefaultType text/html
    SSILegacyExprParser on
</Directory>

# the Imagemap module is required for Apache 2.2.x
# "New" ImageMap support
AddHandler imap-file map

# Treatment of bogus coodinates
# ImapMenu semiformatted

# new Apache 1.1.1 additions for content negotiation
# AddLanguage allows you to specify the language of a document. You can
# then use content negotiation to give a browser a file in a language
# it can understand.  Note that the suffix does not have to be the same
# as the language keyword --- those with documents in Polish (whose
# net-standard language code is pl) may wish to use "AddLanguage pl .po"
# to avoid the ambiguity with the common suffix for perl scripts.

AddLanguage en .en
AddLanguage fr .fr
AddLanguage de .de
AddLanguage da .da
AddLanguage el .el
AddLanguage it .it

# LanguagePriority allows you to give precedence to some languages
# in case of a tie during content negotiation.
# Just list the languages in decreasing order of preference.

LanguagePriority en fr de

# Redirect allows you to tell clients about documents which used to exist in
# your server's namespace, but do not anymore. This allows you to tell the
# clients where to look for the relocated document.
# Format: Redirect fakename url

# Order is significant for Redirect and Alias
# Group by the top level directory affected, usually put longest first

# ------------------------------------------
# Aliases added for virtual hosts to inherit: do not remove
# Albert Lunde 7/1/97
Alias /icons/ /nuinfo/httpd/icons/
Alias /image/ /nuinfo/httpd/htdocs/image/

# global prefix /shared/ for UR to use in templates, etc. 1-10-02
Alias /shared/ /nuinfo/httpd/more-docs/shared/

# image directories for specific CGIs - Albert Lunde 11-12-01

# This was made visible on all virtual hosts
# because /cgi-bin/ is visible on all virtual hosts

Alias /cgi-script-images/ /nuinfo/httpd/more-docs/cgi-script-images/

# ------------------------------------------

# Special alias to reference some IT server side includes
# outside the IT virtual host, for things like /resnet/ 8-9-01
Alias /ssi/it/menu-ssi/     /nuinfo/httpd/htdocs/it-menu/menu-ssi/

# Note here: ORDER OF ALIASES IS SIGNIFICANT: THE MOST SPECIFIC MUST GO FIRST

# Alias for server-side includes 9/30/97
Alias /ssi/ /nuinfo/httpd/more-docs/ssi/

# ------------------------------------------
# Health check html SSI and text file for the load-balancer 9-30-2011
# Aliased into all virtual hosts
Alias /health-check-test.html /nuinfo/httpd/more-docs/health-check-document/health-check-test.html
Alias /health-check-test.txt /nuinfo/httpd/more-docs/health-check-document/health-check-test.txt
# add directory of generated HTML files 11-2-2011
Alias /health-check-test-files/ /nuinfo/httpd/more-docs/health-check-document/test-files/
<Directory /nuinfo/httpd/more-docs/health-check-document>
    # Expire in 15 seconds
    ExpiresByType text/html A15
    ExpiresByType text/plain A15

    Require all granted

    SSILegacyExprParser on
</Directory>
# ------------------------------------------

# ------------------------------------------
# Alias for "private" directories

# TSS Consulting services, for Lynne 8-24-03
# in case we need access direct to proxy
Alias /it-tss-cs-private/ /nuinfo/httpd/more-docs/csstaff-private/private/

# for access via itstaff's proxy, below
Alias /it-staff-private/TSS/cs/ /nuinfo/httpd/more-docs/csstaff-private/private/
# itstaff proxy access 2-18-99
Alias /it-staff-private/ /nuinfo/httpd/more-docs/itstaff-private/private/

<Location /it-staff-private/TSS/tandw >
    # prepare for move of IT and TSS Intanet sites 2-2-07
    # deny access to URL corresponding to old directors-only site in proxy CGI
    Require all denied
</Location>

# form for it consulting services and facilities management 7-17-01
Alias /it-cs-private/ /nuinfo/httpd/htdocs/it/cs/private/

# new directory for possible cms-managed "private" files 8-12-04
Alias /it-cms-private/ /nuinfo/httpd/more-docs/it-cms-private/private/

<Directory /nuinfo/httpd/more-docs/it-cms-private/private>
    # access restrictions here rather than in .htaccess

    # force this directory to go through the SNAP netid proxy
    # https://snap.it.northwestern.edu/p/p.cgi/somealias/something.html
    #
    Require all denied
    #
    # allow from snap.it.northwestern.edu (proxy cgi)
    # list all IP addresses
    Require host 129.105.16.59
    Require host 129.105.16.159
    Require host 129.105.16.169

    SSILegacyExprParser on
</Directory>

# ------------------------------------------

# General aliases here:
# replace with Redirect of www.${local_Domain_Name}/jazz to www.wnur.org/jazz 8-16-04
#Alias /jazz /nuinfo/httpd/htdocs/WNUR/jazz
#Redirect the corresponding search CGI on all hosts, too 8-16-04
Redirect /cgi-bin/jazz-search.pl    http://www.wnur.org/cgi-bin/jazz-search.pl

# ScriptAlias: This controls which directories contain server scripts.
# Format: ScriptAlias fakename realname

# main CGI directory
ScriptAlias /cgi-bin/ /nuinfo/httpd/cgi-bin/

# 1-29-98 - turn off Expires on CGIs to reduce bogus
# caching of cgi results

<Location /cgi-bin/ >
    ExpiresActive Off
</Location>

<Directory /nuinfo/httpd/cgi-bin/ >
    ExpiresActive Off
    SSILegacyExprParser on
</Directory>

# special error documents for /cgi-bin/ on cluster host
# nuinfo accounting go away message

# make the alias on all hosts for testing
Alias /nuinfo-acc-not-available-error/ /nuinfo/httpd/more-docs/cluster-only/nuinfo-acc-not-available/
Alias /cluster-only-cgi-error/ /nuinfo/httpd/more-docs/cluster-only/cgi-not-available/

<Location /cgi-bin/ >
    ErrorDocument 404 /cluster-only-cgi-error/
</Location>

RedirectMatch permanent ^/department-accounting/    http://www.${local_Domain_Name}/nuinfo-acc-not-available-error/
RedirectMatch permanent ^/department-accounting$    http://www.${local_Domain_Name}/nuinfo-acc-not-available-error/
RedirectMatch permanent ^/passport-auth/cgi/dept-database/  http://www.${local_Domain_Name}/nuinfo-acc-not-available-error/
RedirectMatch permanent ^/passport-auth/cgi/dept-database$  http://www.${local_Domain_Name}/nuinfo-acc-not-available-error/

<Location /passport-auth/cgi/dept-database/ >
    ErrorDocument 404 /nuinfo-acc-not-available-error/
</Location>

# redirect dashboard CGI toa URL on www.it.${local_Domain_Name}
# so that URL will control access to it
RedirectMatch ^/cgi-bin/dashboard.pl    http://www.it.${local_Domain_Name}/dashboard/dashboard.pl

# set up proxy authenticated CGI and HTML directories

ScriptAlias /proxy-cgi/cgi/ /nuinfo/httpd/proxy-cgi/cgi/
Alias /proxy-cgi/html/ /nuinfo/httpd/proxy-cgi/html/

<Location /proxy-cgi/cgi/ >
    # try to prevent HTTP/1.1 chunking
    SetEnv downgrade-1.0 1

    ExpiresActive Off
</Location>

<Directory /nuinfo/httpd/proxy-cgi/cgi/ >
    ExpiresActive Off
    SSILegacyExprParser on
</Directory>

# environment variable for special cgi
SetEnvIf Request_URI "^/proxy-cgi/cgi/account/" CGICOOKIE=74570a054ca403441cc077e73d33b716

# restricted directory for staff testing 2/28/96
ScriptAlias /staff-test-cgi/ /nuinfo/httpd/staff-test-cgi/

<Location /staff-test-cgi/ >
ExpiresActive Off
</Location>

# restricted directory for staff testing of documents 10/15/98
Alias /staff-test-html/ /nuinfo/httpd/staff-test-html/


#directory mappings for opentext 6/18/96
# fix /otdoc/ 1-24-97
# update for livelink 7.2 8/26/97
#

<Location /otadmcgi/ >
ExpiresActive Off
</Location>

<Location /otcgi/ >
ExpiresActive Off
</Location>

# location to access legacy opentext search 8-22-01
# turn off 10-20-01
#Alias /opentext-search/    /nuinfo/httpd/more-docs/opentext-search/
#Alias /opentext-search /nuinfo/httpd/more-docs/opentext-search/

# turn off feedback cgi 7/21/00
# production: alias /feedback/ directory to feedback cgi 5/11/98
#ScriptAlias /feedback/index.html /nuinfo/httpd/cgi-bin/feedback.cgi

#<Location /feedback/index.html >
#ExpiresActive Off
#</Location>

# test no Expires on a websso directory 11-19-08
<Location /test-websso-auth-dir  >
#ExpiresActive Off
ExpiresDefault now
ExpiresByType text/html now
</Location>

#
# message for /ev-chi/ redirection
Alias /discontinued-ev-chi/ /nuinfo/httpd/more-docs/discontinued-ev-chi/

# special redirects for search-mirror trick
<Directory /nuinfo/httpd/htdocs/search-mirrors >
    RewriteEngine on
    RewriteRule "^([^/]+)/index.html$" "$1/"
    RewriteRule "^([^/]+)/([^/]+)/index.html$" "$1/$2/"
    RewriteRule "^([^/]+)/([^/]+)/([^/]+)/index.html$" "$1/$2/$3/"
    RewriteRule "^([^/]+)/([^/]+)/([^/]+)/([^/]+)/index.html$" "$1/$2/$3/$4/"
    RewriteRule "^([^/]+)/(.*)$" "http://$1/$2" [R]
    SSILegacyExprParser on
</Directory>

# rewrite home page of /image/ directory to http://www.${local_Domain_Name}/logo/
# across all virtual hosts
RewriteEngine on
RewriteRule ^/image/$               http://www.${local_Domain_Name}/logo/   [R,L]
RewriteRule ^/image/index.html$ http://www.${local_Domain_Name}/logo/   [R,L]

# RewriteMap to map URLs to lowercase
RewriteMap tolower  int:tolower

# ###########################################################
# start of former access.conf
# ###########################################################

#
# added 6/3/98 explict allow/deny for all directories
# Note that <Directory> sections are applied shortest match first

# everywhere not specified
Options None

# deny everything by default
<Directory / >
    AllowOverride None
    Options None
    Require all denied
    SSILegacyExprParser on
</Directory>

# hide .htaccess files
<Files ~ "\.htaccess*" >
    Require all denied
</Files>

# hide Mac .DS_Store files accidentally uploaded
<Files ~ "\.DS_Store" >
    Require all denied
</Files>

# access via the the main document root
<Directory /nuinfo/httpd/htdocs >

    # This may also be "None", or any combination of "Indexes",
    # "Includes", or "FollowSymLinks"

    # Options All
    # changed 6/24/96 to be more paranoid
    Options -Indexes +IncludesNOEXEC +FollowSymLinks

    # allow XBitHack to turn on server side includes
    # Commented out for cluster config 10-3-2011
    # XBitHack is now moot because we have .ssi on for all HTML file types
    # XBitHack full

    # This controls which options the .htaccess files in directories can
    # override. Can also be "None", or any combination of "Options", "FileInfo",
    # "AuthConfig", and "Limit"

    AllowOverride AuthConfig Limit

    # Controls who can get stuff from this server.

    <IfDefine !DENYFORTEST>
        # normal "allow from everywhere"
	Require all granted
    </IfDefine>
    <IfDefine DENYFORTEST>
        # restricted access for preproduction testing
	Require all denied
        # TSS staff desktops
        allow from 129.105.188.0/24
        # ITMS/Identity Services
        allow from 129.105.233.0/24
        # University Relations Web Communications
        allow from 129.105.24.0/24
        # NUIT Security
        allow from 129.105.46.112/28
        # CI-PIM Admins
        allow from 129.105.214.0/24
        # IPv4 localhost
        allow from 127.0.0.1
        # IPv6 localhost
        allow from ::1
        # Solaris nuinfo/chnuinfo
        allow from 129.105.16.72
        allow from 165.124.67.10
        # cluster web nodes / load-balancer
        allow from 129.105.215.0/24
        allow from 165.124.65.0/24
        # load testing
        allow from 129.105.56.17 129.105.74.67 129.105.74.68 129.105.74.69 129.105.74.70 129.105.74.77 165.124.187.10
        # load testing private address range
        allow from 10.14.34.0/24
        # Nagios groundwork.ci.${local_Domain_Name}
        allow from 129.105.106.28
        # Albert Lunde 3rd party ISP, for testing
        # panix1.panix.com, panix2.panix.com, panix3.panix.com
        allow from 166.84.1.1
        allow from 166.84.1.2
        allow from 166.84.1.3

    </IfDefine>

    # end /nuinfo/httpd/htdocs
    SSILegacyExprParser on
</Directory>

# explicitly grant access for Alias, ScriptAlias and virtual hosts outside /nuinfo/httpd/htdocs here:

#----------------------------------
# /proxy-cgi/
<Directory /nuinfo/httpd/proxy-cgi >

    # restrict access by directory for SNAP proxy
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit
    #AllowOverride All

    IndexOptions FancyIndexing IconsAreLinks

    #
    # move access rules to Location block

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/proxy-cgi/cgi >

    # only allow AllowOverride All on CGI subtree, owned by root, not on shared html
    AllowOverride All

    SSILegacyExprParser on
</Directory>

# /proxy-cgi/ - stuff specific to proxy CGI access
<Location /proxy-cgi >
    Require all denied
    #
    # allow from snap.it.${local_Domain_Name} (proxy cgi)
    allow from 129.105.16.59
    # added second IP 12-17-01
    allow from 129.105.16.159
    # adjust IP list 4-18-03
    allow from 129.105.16.169

    # allow from socrates
    #allow from socrates.tss.nwu.edu
    #allow from socrates.tss.${local_Domain_Name}

    # test proxy from socrates
#   SetEnvIf Remote_Addr "129\.105\.233\.63"    HTTP_REMOTEADDR=129.105.233.63
#   SetEnvIf Remote_Addr "129\.105\.233\.63"    HTTP_REMOTEUSER=lunde

</Location>
#----------------------------------

# /cgi-bin/
<Directory /nuinfo/httpd/cgi-bin/ >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All

        # normal "allow from everywhere"
    Require all granted

    # Put in Deny directives to block spammers here
    # Use CIDR block syntax
    # Spam from 91.214.45.46 on 2-11-2010
    deny from 91.214.44.0/24
    # Spam from 202.73.13.122 on 2-21-2010
    deny from 202.73.13.0/24
    # spam from 89.97.5.189 on 2-21-2010
    deny from 89.97.5.0/24

    # end /nuinfo/httpd/cgi-bin/
    SSILegacyExprParser on
</Directory>

# /cgi-bin/dining-services-menu/
<Directory /nuinfo/httpd/cgi-bin/dining-services-menu >
    AuthType Basic
    AuthUserFile /nuinfo/httpd/cgi-data/dining-services-menu/webconf/menu-passwd
    AuthName "Dining Services Menus"
    require valid-user
    SSILegacyExprParser on
</Directory>

# directory with IP restriction for breaking news helper touch-home-two
# 9-6-05
<Directory /nuinfo/httpd/cgi-bin/touch-home-two >
    AllowOverride None
    #
    Require all denied
    #
    # socrates (Albert Lunde Desktop)
    allow from socrates.tss.${local_Domain_Name}
    # UR/IT WCMS server
    allow from rhodes.it.${local_Domain_Name}
    # random UR desktops, for testing
    allow from ur.${local_Domain_Name}
    SSILegacyExprParser on
</Directory>

# /staff-test-cgi/ directories treated below

# /staff-test-html/ directories treated below

# /icons/ alias
<Directory /nuinfo/httpd/icons >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit

    # normal "allow from everywhere"
    Require all granted

    # end /nuinfo/httpd/icons
    SSILegacyExprParser on
</Directory>

# more-docs: ssi and other stuff
<Directory /nuinfo/httpd/more-docs >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All
    # normal "allow from everywhere"
    Require all granted
    # end /nuinfo/httpd/more-docs
    SSILegacyExprParser on
</Directory>

# placeholder to Alias in place of redirect directories
# to generate hard errors
<Directory /nuinfo/httpd/more-docs/empty-error-placeholder >
    Options None

    # normal "allow from everywhere"
    Require all granted

# end /nuinfo/httpd/more-docs/empty-error-placeholder
    SSILegacyExprParser on
</Directory>

# virtual postcards card data and preview directories
# these are web directories but not trusted a lot
# indexes are disabled to give postcard users more privacy
<Directory /nuinfo/httpd/cgi-data/virtual-postcard/cards >
    Options +IncludesNOEXEC
    # XBitHack full
    AllowOverride None

    # normal "allow from everywhere"
    Require all granted

    # end nuinfo/httpd/cgi-data/virtual-postcard/cards
    SSILegacyExprParser on
</Directory>


# perl5 html docs
<Directory /opt/local/lib/perl5/html >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride None

    # normal "allow from everywhere"
    Require all granted

    # end nuinfo/httpd/cgi-data/virtual-postcard/cards
    SSILegacyExprParser on
</Directory>

# perl5.6.1 html docs
<Directory /nuinfo/local/perl56/html >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride None

    # normal "allow from everywhere"
    Require all granted

    # end nuinfo/httpd/cgi-data/virtual-postcard/cards
    SSILegacyExprParser on
</Directory>

# IT test virtual hosts
<Directory /nuinfo/httpd/new-look >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit

    # normal "allow from everywhere"
    Require all granted

    # end nuinfo/httpd/cgi-data/virtual-postcard/cards
    SSILegacyExprParser on
</Directory>

# UR menus virtual host
<Directory /nuinfo/httpd/new-top >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit

    # normal "allow from everywhere"
    Require all granted

    # end /nuinfo/httpd/new-top
    SSILegacyExprParser on
</Directory>

# lunde demo virtual host
<Directory /nuinfo/httpd/new-demo2 >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit

    # normal "allow from everywhere"
    Require all granted

    # end /nuinfo/httpd/new-demo2
    SSILegacyExprParser on
</Directory>

# lunde test-ssi virtual host
<Directory /nuinfo/httpd/test-ssi >
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig Limit

    # normal "allow from everywhere"
    Require all granted

    # end /nuinfo/httpd/test-ssi
    SSILegacyExprParser on
</Directory>

# was in .htaccess; mostly cosmetic for testing
<Directory /nuinfo/httpd/more-docs/ssi >
    # treat everything in this directry as server-side-includes

    AddType text/html .html
    AddHandler server-parsed .html

    AddType text/html .htm
    AddHandler server-parsed .htm

    SSILegacyExprParser on
</Directory>

# for selected directories
# turn on ssi for all HTML files so folks don't have to remember
# to set permissions

<Directory /nuinfo/httpd/htdocs/president >
    # treat everything in this directry as server-side-includes

    AddType text/html .html
    AddHandler server-parsed .html

    AddType text/html .htm
    AddHandler server-parsed .htm

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/htdocs/tss/troubleshoot >
    # treat everything in this directry as server-side-includes

    AddType text/html .html
    AddHandler server-parsed .html

    AddType text/html .htm
    AddHandler server-parsed .htm

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/htdocs/it >
    # treat everything in this directry as server-side-includes
    # for Lynne 7/27/99

    AddType text/html .html
    AddHandler server-parsed .html

    AddType text/html .htm
    AddHandler server-parsed .htm

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/more-docs/itstaff-private/private >
    # treat everything in this directry as server-side-includes
    # for Laurie Rubin 6/21/00

    AddType text/html .html
    AddHandler server-parsed .html

    AddType text/html .htm
    AddHandler server-parsed .htm

    SSILegacyExprParser on
</Directory>

# to allow Joe G. to use custom ErrorDocument for WNUR
<Directory /nuinfo/httpd/htdocs/WNUR >
    AllowOverride AuthConfig Limit Fileinfo
    SSILegacyExprParser on
</Directory>
<Directory /nuinfo/httpd/htdocs/wnur >
    AllowOverride AuthConfig Limit Fileinfo
    SSILegacyExprParser on
</Directory>
#<Location /wnur >
#   AllowOverride is not allowed in Location, Apache 2.2.x reports this
#   AllowOverride AuthConfig Limit Fileinfo
#</Location>

# redirect CGI development host
<Directory /nuinfo/httpd/more-docs/redirect-demo >

# don't Cache results
ExpiresActive Off

# allow "unsafe" stuff not allowed for normal content

AllowOverride All

#AddHandler cgi-script cgi

Options -Indexes +Includes +FollowSymLinks +ExecCGI

# pass PATH_INFO to everything
AcceptPathInfo On

    SSILegacyExprParser on
</Directory>

# special handlers for system administration

<Location /apache-server-status>
    SetHandler server-status
    # domain _or_ password restricted
    Require all denied
    <RequireAny>
        Require ip 165.124.226.128/26
        Require ip 165.124.201.240/29
    </RequireAny>
    # tss static ip subset
    # require host northwestern.edu
    # AuthType Basic
    # AuthUserFile /nuinfo/httpd/passwords/proto-htpass
    # AuthName "Nuinfo System Administration"
    # require valid-user
    # satisfy any
</Location>

<Location /apache-server-info>
    SetHandler server-info
    # domain _or_ password restricted
    Require all denied
    <RequireAny>
        Require ip 165.124.226.128/26
        Require ip 165.124.201.240/29
    </RequireAny>
    # tss static ip subset
    # allow from 129.105.188.
    # tss netreg subset
    # allow from 129.105.219.
    # allow from 129.105.214.
    # allow from .tss.${local_Domain_Name}
    # allow from bartok.itcs.${local_Domain_Name}
    # Przemyslaw Krydka IT Portal developer doing load tests 6-11-08
    # allow from 129.105.233.18
    # AuthType Basic
    # AuthUserFile /nuinfo/httpd/passwords/proto-htpass
    # AuthName "Nuinfo System Administration"
    # require valid-user
    # satisfy any
</Location>

# access limits on content directories

<Directory /nuinfo/httpd/htdocs/academic/ctec>

    Require all denied
    allow from .${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

#
# mod_proxy directives were here, but we don't want to use it
# because it is a security risk that we don't need
#



# ############# Test directories below ##################

# restricted staff test directory rev 5/14/97, 10/31/97
#  Access limited to staffnet, nuinfo, univ relations,  and selected IP
#  fury.res-hall.nwu.edu was Steven Traykovski <stevent@nwu.edu>
#  chester.res-hall.nwu.edu was Joe Schwab
#  129.105.212.72 is nuinfo
#  ur.${local_Domain_Name} is university relations (added 5/21/98)
#  24.9.207.246 / c542574-c.hlndpk1.il.home.com is Steve DiDomenico <steve@${local_Domain_Name}>

# 10/15/98 add parallel directory /staff-test-html/
# 10/15/98 remove fury.res-hall.nwu.edu no longer in DNS
# 1/21/99 add more refs to tss.nwu.edu, allow access for register,summernu
# reduce use of numeric addresses in anticipation of move
# 5/17/99 further reduce references to subnet 110, add refs to 233
# (network IPs are still there to allow access to AT staff machines)
# 6/25/99 comment out last refs to 110

<Directory /nuinfo/httpd/staff-test-cgi>

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride AuthConfig FileInfo Indexes

    Require all denied
    # allow from 129.105.110
    allow from 129.105.233

    # Steve DiDomenico 9/22/00
    allow from 24.9.207.246
    allow from c542574-c.hlndpk1.il.home.com

    allow from nuinfo.${local_Domain_Name}
    allow from ur.${local_Domain_Name}
    allow from tss.${local_Domain_Name}

    # subnet with UR Web communications
    allow from 129.105.24.0/24

    # tss static ip subset
    allow from 129.105.188.
    # tss netreg subset
    allow from 129.105.219.

    # Adam Findlayson wcas 2-7-07
    allow from zero.wcas.${local_Domain_Name}
    allow from 105.29.249.229

    # end /nuinfo/httpd/staff-test-cgi
    SSILegacyExprParser on
</Directory>


# this should be a clone of the setup for the main document
# root except for access restrictions
<Directory /nuinfo/httpd/staff-test-html >

    # This may also be "None", or any combination of "Indexes",
    # "Includes", or "FollowSymLinks"

    # Options All
    # changed 6/24/96 to be more paranoid
    Options -Indexes +IncludesNOEXEC +FollowSymLinks

    # allow XBitHack to turn on server side includes
    # XBitHack full

    # This controls which options the .htaccess files in directories can
    # override. Can also be "None", or any combination of "Options", "FileInfo",
    # "AuthConfig", and "Limit"

    AllowOverride AuthConfig Limit

    # Controls who can get stuff from this server.

    Require all denied
    # allow from 129.105.110
    allow from 129.105.233

    # Steve DiDomenico 9/22/00
    allow from 24.9.207.246
    allow from c542574-c.hlndpk1.il.home.com

    allow from nuinfo.nwu.edu
    allow from ur.nwu.edu
    allow from tss.nwu.edu

    allow from nuinfo.${local_Domain_Name}
    allow from ur.${local_Domain_Name}
    allow from tss.${local_Domain_Name}

    # subnet with UR Web communications
    allow from 129.105.24.0/24

    # tss static ip subset
    allow from 129.105.188.
    # tss netreg subset
    allow from 129.105.219.

    # Adam Findlayson wcas 2-7-07
    allow from zero.wcas.${local_Domain_Name}
    allow from 105.29.249.229

    # end /nuinfo/httpd/staff-test-html
    SSILegacyExprParser on
</Directory>

# Lunde test directory for mixed HTML and CGI content

<Directory /nuinfo/httpd/staff-test-html/lunde/mixed >

# DO NOT USE +ExecCGI IN ANY PRODUCTION DIRECTORIES ON NUINFO
Options -Indexes +IncludesNOEXEC +FollowSymLinks +ExecCGI
# XBitHack full
# AllowOverride AuthConfig Limit
AllowOverride All

# DO NOT USE DIRECTIVE THIS IN ANY PRODUCTION DIRECTORIES ON NUINFO
AddHandler cgi-script cgi

# Like Aquavite
DirectoryIndex index.html index.htm home.html home.htm index.cgi

# Rewrite rules to fake out URLs
#RewriteEngine on
#RewriteOptions inherit
# This causes an infinite loop! but may be close to a real answer
#RewriteBase /staff-test-html/lunde/mixed
#RewriteRule ^secure(.*)    secure/index.cgi/$1     [L,NS]
#RewriteRule ^test(.*)  test.cgi/$1             [L,NS]
#RewriteRule ^(.*)      index.cgi/$1            [L,NS]


# Controls who can get stuff from this server.

Require all denied
allow from nuinfo.${local_Domain_Name}
#allow from ur.${local_Domain_Name}
allow from tss.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/staff-test-cgi/tmazza/secure>

    # Ted's passwd auth test directory

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All

    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/jschwab>

Options -Indexes +IncludesNOEXEC +FollowSymLinks
# XBitHack full
AllowOverride All

order mutual-failure
# deny from all
allow from .${local_Domain_Name}

allow from 129.105.233

allow from nuinfo.${local_Domain_Name}
allow from ur.${local_Domain_Name}
allow from tss.${local_Domain_Name}

# keep out res-halls, labs
deny from res-hall.nwu.edu
deny from at.nwu.edu

deny from res-hall.${local_Domain_Name}
deny from at.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/staff-test-cgi/jschwab/secure>

    # Joe's passwd auth test directory

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All

    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/lunde/passtest>

    # Albert Lunde passwd auth test directory

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All

    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from ur.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/lunde/switch>

    # Albert Lunde breaking news test directory

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride All

    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from ur.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/lunde/breaking-news >
    # new breaking news test with passport auth
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    AllowOverride All

    Require all denied

    allow from tss.${local_Domain_Name}
    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/lunde/breaking-static >
    # new breaking news test with static pw auth
    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    AllowOverride All

    AuthType Basic
    AuthUserFile /nuinfo/httpd/passwords/brnews2-htpass
    AuthName "Breaking News Prototype"

    Require all denied
    allow from tss.${local_Domain_Name}


    require valid-user
    satisfy All

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/summernu>

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride None

    Require all denied
    # test dir for David Parrish summernu 4/17/96
    # expanded to allow access from all of ed.nwu.edu 1/21/99

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from ed.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-html/summernu>

    Require all denied
    # test html dir for summernu

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from ed.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/staff-test-cgi/register >

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride None

    # test cgi dir for Registrar/Tamara
    Require all denied

    # Tamara Foster
    allow from nuinfo.${local_Domain_Name}
    allow from ur.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from registrar.${local_Domain_Name}
    # Tamara Foster
    allow from isdn216046.isdn.${local_Domain_Name}
    allow from norge.crown.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-html/register >

    # test html for Registrar/Tamara
    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from ur.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from registrar.${local_Domain_Name}
    # Tamara Foster
    allow from isdn216046.isdn.${local_Domain_Name}
    allow from norge.crown.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/staff-test-cgi/gsd944 >

    Options -Indexes +IncludesNOEXEC +FollowSymLinks
    # XBitHack full
    AllowOverride None

    # test cgi dir for Graduade School Dean/gsd944/Dan McCoy
    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from gsa-orsp.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>


<Directory /nuinfo/httpd/staff-test-html/gsd944 >

    # test html for Graduade School Dean/gsd944/Dan McCoy
    Require all denied

    allow from nuinfo.${local_Domain_Name}
    allow from tss.${local_Domain_Name}
    allow from gsa-orsp.${local_Domain_Name}

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-cgi/mrj666 >

    # test CGI for mrj666 Michael R Johnson - University Relations student
    Require all denied

    allow from .tss.${local_Domain_Name}
    allow from .ur.${local_Domain_Name}
    allow from nuinfo.${local_Domain_Name}

    AuthType Basic
    AuthUserFile /nuinfo/httpd/passwords/ur-student-htpass
    AuthName "Staff Test Prototype"
    require valid-user
    satisfy any

    SSILegacyExprParser on
</Directory>

<Directory /nuinfo/httpd/staff-test-html/mrj666 >

    # test html for mrj666 Michael R Johnson - University Relations student
    Require all denied

    allow from .tss.${local_Domain_Name}
    allow from .ur.${local_Domain_Name}
    allow from nuinfo.${local_Domain_Name}

    AuthType Basic
    AuthUserFile /nuinfo/httpd/passwords/ur-student-htpass
    AuthName "Staff Test Prototype"
    require valid-user
    satisfy any

    SSILegacyExprParser on
</Directory>
#
<IfModule mod_perl.c>

PerlModule Apache::Registry

# Apache::Registry directives we want to apply everywhere possible
PerlTaintCheck On
PerlFreshRestart On

# end mod_perl
</IfModule>
#

RewriteEngine on
RewriteCond %{REQUEST_METHOD}  !^(GET|POST|HEAD|OPTIONS)$
RewriteRule .* - [F]
#

TraceEnable off

# global test directory for websso policy checking
Alias /test-websso-auth-dir/    /nuinfo/httpd/more-docs/test-websso-auth-dir/
Alias /test-websso-auth-dir     /nuinfo/httpd/more-docs/test-websso-auth-dir/

<Location /test-websso-auth-dir >
    Require all denied
    # allow access from selected test address
    # but not the world at large
    allow from 129.105.233
    allow from 129.105.16.72
    allow from 165.124.67.10
    allow from .itcs.${local_Domain_Name}
    allow from .it.${local_Domain_Name}
    allow from .tss.${local_Domain_Name}
    allow from .ur.${local_Domain_Name}
</Location>
